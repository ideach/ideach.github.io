<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.59">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/hero-2.webp"><title>Ansible文档 | 我的工作文档</title><meta name="description" content="Ansible文档">
    <link rel="preload" href="/assets/style-6fb018bf.css" as="style"><link rel="stylesheet" href="/assets/style-6fb018bf.css">
    <link rel="modulepreload" href="/assets/app-9833b164.js"><link rel="modulepreload" href="/assets/framework-96b046e1.js"><link rel="modulepreload" href="/assets/ansible.html-cf3f36f8.js"><link rel="modulepreload" href="/assets/ansible.html-f4b0a52e.js"><link rel="prefetch" href="/assets/index.html-53a23ace.js" as="script"><link rel="prefetch" href="/assets/docker.html-8b3791ab.js" as="script"><link rel="prefetch" href="/assets/k8s.html-9fb7fe23.js" as="script"><link rel="prefetch" href="/assets/nginx.html-60bffb5c.js" as="script"><link rel="prefetch" href="/assets/openstack.html-430c0e06.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-b9433858.js" as="script"><link rel="prefetch" href="/assets/basic.html-09645acd.js" as="script"><link rel="prefetch" href="/assets/lib.html-dc07ae7a.js" as="script"><link rel="prefetch" href="/assets/scrapy.html-9ab34af7.js" as="script"><link rel="prefetch" href="/assets/git.html-5d9565db.js" as="script"><link rel="prefetch" href="/assets/sync.html-fda667d3.js" as="script"><link rel="prefetch" href="/assets/vim.html-468d840a.js" as="script"><link rel="prefetch" href="/assets/basic.html-b82e8bad.js" as="script"><link rel="prefetch" href="/assets/doubt.html-8e998b16.js" as="script"><link rel="prefetch" href="/assets/shell.html-b1dfb836.js" as="script"><link rel="prefetch" href="/assets/doubt.html-cf5a2aca.js" as="script"><link rel="prefetch" href="/assets/install.html-4b6649c8.js" as="script"><link rel="prefetch" href="/assets/sql.html-d87207f3.js" as="script"><link rel="prefetch" href="/assets/doubt.html-4a3a2ba6.js" as="script"><link rel="prefetch" href="/assets/install.html-93128002.js" as="script"><link rel="prefetch" href="/assets/sql.html-37dbfe9c.js" as="script"><link rel="prefetch" href="/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/assets/index.html-d44a0252.js" as="script"><link rel="prefetch" href="/assets/docker.html-7d1a67b0.js" as="script"><link rel="prefetch" href="/assets/k8s.html-e968ecc1.js" as="script"><link rel="prefetch" href="/assets/nginx.html-6f42f7e4.js" as="script"><link rel="prefetch" href="/assets/openstack.html-128abd0f.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-ad24dd13.js" as="script"><link rel="prefetch" href="/assets/basic.html-05dc9715.js" as="script"><link rel="prefetch" href="/assets/lib.html-2a626e56.js" as="script"><link rel="prefetch" href="/assets/scrapy.html-e4cafc41.js" as="script"><link rel="prefetch" href="/assets/git.html-e9cb9417.js" as="script"><link rel="prefetch" href="/assets/sync.html-a88d82c8.js" as="script"><link rel="prefetch" href="/assets/vim.html-86becee4.js" as="script"><link rel="prefetch" href="/assets/basic.html-d684bedb.js" as="script"><link rel="prefetch" href="/assets/doubt.html-5b5130a2.js" as="script"><link rel="prefetch" href="/assets/shell.html-2b4f6a5f.js" as="script"><link rel="prefetch" href="/assets/doubt.html-639aaba9.js" as="script"><link rel="prefetch" href="/assets/install.html-091a3875.js" as="script"><link rel="prefetch" href="/assets/sql.html-edaa1ff6.js" as="script"><link rel="prefetch" href="/assets/doubt.html-a85fe5da.js" as="script"><link rel="prefetch" href="/assets/install.html-6c0d1411.js" as="script"><link rel="prefetch" href="/assets/sql.html-32f96f3b.js" as="script"><link rel="prefetch" href="/assets/404.html-46166703.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/hero-2.webp" alt="我的工作文档"><span class="site-name can-hide">我的工作文档</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Linux文档"><span class="title">Linux文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Linux文档"><span class="title">Linux文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Linux基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/linux/system/basic.html" class="" aria-label="基本命令"><!--[--><!--]--> 基本命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/linux/system/shell.html" class="" aria-label="Shell文档"><!--[--><!--]--> Shell文档 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/linux/system/doubt.html" class="" aria-label="常见问题"><!--[--><!--]--> 常见问题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>开源工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/linux/open/vim.html" class="" aria-label="Vim文档"><!--[--><!--]--> Vim文档 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/linux/open/git.html" class="" aria-label="Git文档"><!--[--><!--]--> Git文档 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/linux/open/sync.html" class="" aria-label="Sync文档"><!--[--><!--]--> Sync文档 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="SQL文档"><span class="title">SQL文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="SQL文档"><span class="title">SQL文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>MySQL文档</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/sql/mysql/install.html" class="" aria-label="安装部署"><!--[--><!--]--> 安装部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/sql/mysql/sql.html" class="" aria-label="SQL基础"><!--[--><!--]--> SQL基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/sql/mysql/doubt.html" class="" aria-label="常见问题"><!--[--><!--]--> 常见问题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Radis文档</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/sql/redis/install.html" class="" aria-label="安装部署"><!--[--><!--]--> 安装部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/sql/redis/sql.html" class="" aria-label="SQL基础"><!--[--><!--]--> SQL基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/sql/redis/doubt.html" class="" aria-label="常见问题"><!--[--><!--]--> 常见问题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Python文档"><span class="title">Python文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Python文档"><span class="title">Python文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>基础文档</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/python/basic.html" class="" aria-label="Python基础"><!--[--><!--]--> Python基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/python/lib.html" class="" aria-label="Python常用库"><!--[--><!--]--> Python常用库 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>框架文档</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/python/scrapy.html" class="" aria-label="Scrapy框架"><!--[--><!--]--> Scrapy框架 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="开源软件文档"><span class="title">开源软件文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="开源软件文档"><span class="title">开源软件文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>容器技术</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/cloud/docker.html" class="" aria-label="Docker文档"><!--[--><!--]--> Docker文档 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>自动化运维</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/cloud/ansible.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Ansible文档"><!--[--><!--]--> Ansible文档 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Web服务</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/cloud/nginx.html" class="" aria-label="Nginx文档"><!--[--><!--]--> Nginx文档 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/cloud/tomcat.html" class="" aria-label="Tomcat文档"><!--[--><!--]--> Tomcat文档 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="关于网站"><!--[--><!--]--> 关于网站 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Linux文档"><span class="title">Linux文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Linux文档"><span class="title">Linux文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Linux基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/linux/system/basic.html" class="" aria-label="基本命令"><!--[--><!--]--> 基本命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/linux/system/shell.html" class="" aria-label="Shell文档"><!--[--><!--]--> Shell文档 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/linux/system/doubt.html" class="" aria-label="常见问题"><!--[--><!--]--> 常见问题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>开源工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/linux/open/vim.html" class="" aria-label="Vim文档"><!--[--><!--]--> Vim文档 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/linux/open/git.html" class="" aria-label="Git文档"><!--[--><!--]--> Git文档 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/linux/open/sync.html" class="" aria-label="Sync文档"><!--[--><!--]--> Sync文档 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="SQL文档"><span class="title">SQL文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="SQL文档"><span class="title">SQL文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>MySQL文档</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/sql/mysql/install.html" class="" aria-label="安装部署"><!--[--><!--]--> 安装部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/sql/mysql/sql.html" class="" aria-label="SQL基础"><!--[--><!--]--> SQL基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/sql/mysql/doubt.html" class="" aria-label="常见问题"><!--[--><!--]--> 常见问题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Radis文档</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/sql/redis/install.html" class="" aria-label="安装部署"><!--[--><!--]--> 安装部署 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/sql/redis/sql.html" class="" aria-label="SQL基础"><!--[--><!--]--> SQL基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/sql/redis/doubt.html" class="" aria-label="常见问题"><!--[--><!--]--> 常见问题 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Python文档"><span class="title">Python文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Python文档"><span class="title">Python文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>基础文档</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/python/basic.html" class="" aria-label="Python基础"><!--[--><!--]--> Python基础 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/python/lib.html" class="" aria-label="Python常用库"><!--[--><!--]--> Python常用库 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>框架文档</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/python/scrapy.html" class="" aria-label="Scrapy框架"><!--[--><!--]--> Scrapy框架 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="开源软件文档"><span class="title">开源软件文档</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="开源软件文档"><span class="title">开源软件文档</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>容器技术</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/cloud/docker.html" class="" aria-label="Docker文档"><!--[--><!--]--> Docker文档 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>自动化运维</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/cloud/ansible.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Ansible文档"><!--[--><!--]--> Ansible文档 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Web服务</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/cloud/nginx.html" class="" aria-label="Nginx文档"><!--[--><!--]--> Nginx文档 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/cloud/tomcat.html" class="" aria-label="Tomcat文档"><!--[--><!--]--> Tomcat文档 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="关于网站"><!--[--><!--]--> 关于网站 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">容器技术 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloud/docker.html" class="sidebar-item" aria-label="Docker文档"><!--[--><!--]--> Docker文档 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">自动化运维 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/cloud/ansible.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Ansible文档"><!--[--><!--]--> Ansible文档 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/cloud/ansible.html#软件安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="软件安装"><!--[--><!--]--> 软件安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/cloud/ansible.html#配置详解" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置详解"><!--[--><!--]--> 配置详解 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/cloud/ansible.html#配置文件模版" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置文件模版"><!--[--><!--]--> 配置文件模版 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/cloud/ansible.html#配置文件详解" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置文件详解"><!--[--><!--]--> 配置文件详解 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/cloud/ansible.html#ansible命令详解" class="router-link-active router-link-exact-active sidebar-item" aria-label="Ansible命令详解"><!--[--><!--]--> Ansible命令详解 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/cloud/ansible.html#ansible-playbook剧本详解" class="router-link-active router-link-exact-active sidebar-item" aria-label="Ansible Playbook剧本详解"><!--[--><!--]--> Ansible Playbook剧本详解 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Web服务 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/cloud/nginx.html" class="sidebar-item" aria-label="Nginx文档"><!--[--><!--]--> Nginx文档 <!--[--><!--]--></a><!----></li><li><a href="/cloud/tomcat.html" class="sidebar-item" aria-label="Tomcat文档"><!--[--><!--]--> Tomcat文档 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h1><p><a href="https://docs.ansible.com/ansible/latest/" target="_blank" rel="noopener noreferrer">Ansible官方文档<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="软件安装" tabindex="-1"><a class="header-anchor" href="#软件安装" aria-hidden="true">#</a> 软件安装</h2><p>需要安装<code>epel</code>源, 参考<a href="https://developer.aliyun.com/mirror/epel?spm=a2c6h.13651102.0.0.3e221b11fSNKdz" target="_blank" rel="noopener noreferrer">阿里云epel源<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 安装epel源(两种方式)</span>
<span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo
yum <span class="token function">install</span> epel-release

<span class="token comment"># yum安装Ansible</span>
yum <span class="token function">install</span> ansible <span class="token parameter variable">-y</span>

<span class="token comment"># 验证安装, 并查看版本</span>
ansible <span class="token parameter variable">--version</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置详解" tabindex="-1"><a class="header-anchor" href="#配置详解" aria-hidden="true">#</a> 配置详解</h2><h3 id="配置文件模版" tabindex="-1"><a class="header-anchor" href="#配置文件模版" aria-hidden="true">#</a> 配置文件模版</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 主配置文件模版</span>
/etc/ansible/ansible.cfg 

<span class="token comment"># 主机清单模版</span>
/etc/ansible/hosts

<span class="token comment"># 存放角色目录</span>
/etc/ansible/roles/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置文件详解" tabindex="-1"><a class="header-anchor" href="#配置文件详解" aria-hidden="true">#</a> 配置文件详解</h3><ul><li><h4 id="ansible配置文件查找顺序" tabindex="-1"><a class="header-anchor" href="#ansible配置文件查找顺序" aria-hidden="true">#</a> Ansible配置文件查找顺序</h4><ul><li><ol><li>ANSIBLE_COMFIG 变量定义的配置文件</li></ol></li><li><ol start="2"><li>当前目录下 <code>./ansible.cfg</code></li></ol></li><li><ol start="3"><li>当前用户家目录下 <code>~/ansible.cfg</code></li></ol></li><li><ol start="4"><li><code>/etc/ansible/ansible.cfg</code></li></ol></li></ul></li><li><h4 id="ansible-cfg文件详解" tabindex="-1"><a class="header-anchor" href="#ansible-cfg文件详解" aria-hidden="true">#</a> ansible.cfg文件详解</h4></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>defaults<span class="token punctuation">]</span>
<span class="token comment"># 主机列表配置文件</span>
inventory     <span class="token operator">=</span> /etc/ansible/hosts  

<span class="token comment"># 库文件存放目录</span>
library       <span class="token operator">=</span> /usr/share/my_modules/ 

<span class="token comment"># 临时py命令文件存放在远程主机目录</span>
remote_tmp    <span class="token operator">=</span> <span class="token environment constant">$HOME</span>/.ansible/tmp     

<span class="token comment"># 本机的临时命令执行目录  </span>
local_tmp     <span class="token operator">=</span> <span class="token environment constant">$HOME</span>/.ansible/tmp

<span class="token comment"># 默认并发数,同时可以执行5次</span>
forks         <span class="token operator">=</span> <span class="token number">5</span>

<span class="token comment"># 默认sudo 用户</span>
sudo_user     <span class="token operator">=</span> root

<span class="token comment"># 每次执行ansible命令是否询问ssh密码</span>
ask_sudo_pass <span class="token operator">=</span> True

<span class="token comment"># 每次执行ansible命令是否询问ssh口令   </span>
ask_pass      <span class="token operator">=</span> True

<span class="token comment"># 远程主机的端口号(默认22)</span>
remote_port   <span class="token operator">=</span> <span class="token number">22</span>        

<span class="token comment"># 检查对应服务器的指纹密钥，建议取消</span>
host_key_checking <span class="token operator">=</span> False 

<span class="token comment"># 日志文件,建议取消注释</span>
<span class="token assign-left variable">log_path</span><span class="token operator">=</span>/var/log/ansible.log

<span class="token comment"># 默认模块</span>
module_name   <span class="token operator">=</span> <span class="token builtin class-name">command</span>
<span class="token punctuation">[</span>privilege_escalation<span class="token punctuation">]</span>
<span class="token comment"># 连接后是否切换用户</span>
become <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment"># 切换用户方式 默认sudo</span>
become_method <span class="token operator">=</span> <span class="token function">sudo</span>
<span class="token comment"># 切换用户名</span>
become_user <span class="token operator">=</span> root
<span class="token comment"># 是否需要输入密码</span>
become_ask_pass <span class="token operator">=</span> <span class="token boolean">false</span>      
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><h4 id="hosts文件详解" tabindex="-1"><a class="header-anchor" href="#hosts文件详解" aria-hidden="true">#</a> hosts文件详解</h4></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># []为组名</span>
<span class="token punctuation">[</span>test1<span class="token punctuation">]</span>
node02
<span class="token number">192.168</span>.3.43

<span class="token punctuation">[</span>test2<span class="token punctuation">]</span>
<span class="token comment"># 连续用:分隔</span>
node<span class="token punctuation">[</span>02:03<span class="token punctuation">]</span>

<span class="token comment"># 嵌套组 test3为组名 嵌套test1</span>
<span class="token punctuation">[</span>test1:test3<span class="token punctuation">]</span>
<span class="token comment"># 密码认证格式</span>
node03 <span class="token assign-left variable">ansible_port</span><span class="token operator">=</span><span class="token number">22</span> <span class="token assign-left variable">ansible_user</span><span class="token operator">=</span>root <span class="token assign-left variable">ansible_password</span><span class="token operator">=</span><span class="token string">&#39;142857&#39;</span>
<span class="token comment"># 定义test4组的公共变量批量设置密码登录信息</span>
<span class="token punctuation">[</span>test4:vars<span class="token punctuation">]</span>
<span class="token assign-left variable">ansible_port</span><span class="token operator">=</span><span class="token number">22</span>
<span class="token assign-left variable">ansible_user</span><span class="token operator">=</span>root
<span class="token assign-left variable">ansible_passowrd</span><span class="token operator">=</span><span class="token string">&#39;142857&#39;</span>

<span class="token punctuation">[</span>test4<span class="token punctuation">]</span>
node<span class="token punctuation">[</span>02:03<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ansible命令详解" tabindex="-1"><a class="header-anchor" href="#ansible命令详解" aria-hidden="true">#</a> Ansible命令详解</h3><p><code>Ansible</code> 导出服务器信息为json<br><code>Ansible ad-hoc</code> 命令集<a href="https://blog.51cto.com/u_15060546/2651937" target="_blank" rel="noopener noreferrer">51CTO<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li><h4 id="ansible常用模块" tabindex="-1"><a class="header-anchor" href="#ansible常用模块" aria-hidden="true">#</a> Ansible常用模块</h4></li></ul><table><thead><tr><th style="text-align:left;">模块作用</th><th style="text-align:left;">模块名</th><th style="text-align:left;">模块参数</th></tr></thead><tbody><tr><td style="text-align:left;">检查节点连通性</td><td style="text-align:left;">ping</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">执行命令 默认模块</td><td style="text-align:left;">command</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">执行命令 支持特殊符号</td><td style="text-align:left;">shell</td><td style="text-align:left;">chdir=/目录名 : 切换工作目录<br> removes=/文件名 : 文件存在不执行</td></tr><tr><td style="text-align:left;">分发脚本并执行</td><td style="text-align:left;">script</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">文件目录管理</td><td style="text-align:left;">file</td><td style="text-align:left;">path=/路径 : 目标路径<br>state=touch : 创建文件<br>state=directory : 创建文件夹<br>state=link : 创建软链接<br>state=hard : 创建硬链接<br>state=absent : 删除<br>owner=用户名 : 设置所有者<br>group=组名 : 设置所属组<br>mode=777 : 设置权限</td></tr><tr><td style="text-align:left;">拷贝模块</td><td style="text-align:left;">copy</td><td style="text-align:left;">src=/主机文件 : 设置源文件<br>dest=/tmp/ : 设置目标位置<br>backup=yes : 如果存在则先备份</td></tr><tr><td style="text-align:left;">服务管理模块</td><td style="text-align:left;">systemd</td><td style="text-align:left;">name=nginx : 服务名<br>state=started : 启动服务<br>state=stoped : 关闭服务<br>state=restarted : 重启服务<br>state=reloaded : 重新加载配置文件</td></tr><tr><td style="text-align:left;">YUM包管理模块</td><td style="text-align:left;">yum</td><td style="text-align:left;">name=软件名\软件包路径 : 指定包<br>state=installed : 安装软件<br>state=removed : 卸载软件<br>state=lastest : 更新软件</td></tr><tr><td style="text-align:left;">文件下载模块</td><td style="text-align:left;">git_url</td><td style="text-align:left;">url=&#39;链接&#39; : 文件下载链接<br>dest=/路径 : 文件下载路径</td></tr></tbody></table><ul><li><h4 id="ansible返回状态" tabindex="-1"><a class="header-anchor" href="#ansible返回状态" aria-hidden="true">#</a> Ansible返回状态</h4><ul><li>绿色: 命令已执行 状态没有发生改变</li><li>黄色: 命令已执行 状态发生改变</li><li>紫色: 命令已执行 建议使用规范模块</li><li>蓝色: 命令已执行 打印详细执行过程</li><li>红色: 命令执行失败</li></ul></li><li><h4 id="ansible命令实例" tabindex="-1"><a class="header-anchor" href="#ansible命令实例" aria-hidden="true">#</a> Ansible命令实例</h4></li></ul><p><code>ansibles</code> 是 <code>Ansible</code> 基本操作命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 格式</span>
ansible all/主机集合 <span class="token parameter variable">-m</span> 模块名 <span class="token parameter variable">-a</span> <span class="token string">&quot;命令&quot;</span>
    <span class="token parameter variable">-k</span> <span class="token builtin class-name">:</span> 使用密码远程
    <span class="token parameter variable">-i</span> <span class="token builtin class-name">:</span> 指定主机列表文件

<span class="token comment"># 查看主机列表</span>
ansible all/主机集合 --list-hosts

<span class="token comment"># 使用ping模块</span>
ansible 主机集合 <span class="token parameter variable">-m</span> <span class="token function">ping</span>

<span class="token comment"># 使用command默认模块 不支持 管道符 重定向</span>
ansible 主机集合 <span class="token parameter variable">-a</span> <span class="token string">&quot;ip a s ens33&quot;</span>
ansible 主机集合 <span class="token parameter variable">-m</span> <span class="token builtin class-name">command</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;ip a s ens33&quot;</span>

<span class="token comment"># 使用shell模块</span>
ansible 主机集合 <span class="token parameter variable">-m</span> shell <span class="token parameter variable">-a</span> <span class="token string">&quot;ps ef | grep anon&quot;</span>
<span class="token comment"># 使用chdir切换工作目录 chdir</span>
ansible 主机集合 <span class="token parameter variable">-m</span> shell <span class="token parameter variable">-a</span> <span class="token string">&quot;chdir=/tmp touch my.txt&quot;</span>
<span class="token comment"># 文件存在不执行 create</span>
ansible 主机集合 <span class="token parameter variable">-m</span> shell <span class="token parameter variable">-a</span> <span class="token string">&quot;touch /tmp/abc.txt create=/tmp/abc.txt&quot;</span> 
<span class="token comment"># 文件不存在不执行 removes</span>
ansible 主机集合 <span class="token parameter variable">-m</span> shell <span class="token parameter variable">-a</span> <span class="token string">&quot;chdir=/tmpunzip abc.zip removes=/tmp/abc.txt&quot;</span> 

<span class="token comment"># 使用script模块 分发脚本并执行</span>
ansible 主机集合 <span class="token parameter variable">-m</span> script <span class="token parameter variable">-a</span> <span class="token string">&quot;/控制端主机脚本名&quot;</span>

<span class="token comment"># 使用file模块</span>
ansible 主机集合 <span class="token parameter variable">-m</span> <span class="token function">file</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;/&quot;</span>
<span class="token comment"># 新建文件 state类别 touch创建文件</span>
ansible 主机集合 <span class="token parameter variable">-m</span> <span class="token function">file</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;path=/tmp/abc.txt state=touch&quot;</span>
<span class="token comment"># 新建文件夹 directory创建文件夹</span>
ansible 主机集合 <span class="token parameter variable">-m</span> <span class="token function">file</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;path=/tmp/dir state=directory&quot;</span>
<span class="token comment"># 修改权限 owner所有者 group所属组 mode权限代码</span>
ansible 主机集合 <span class="token parameter variable">-m</span> <span class="token function">file</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;path=/tmp/dir owner=anon group=anon mode=777&quot;</span>
<span class="token comment"># 删除文件/目录 absent 删除</span>
ansible 主机集合 <span class="token parameter variable">-m</span> <span class="token function">file</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;path=/tmp/文件目录名 state=absent&quot;</span>
<span class="token comment"># 创建软链接 src源文件 path链接地址 link创建软链接 hard创建硬链接</span>
ansible 主机集合 <span class="token parameter variable">-m</span> <span class="token function">file</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;src=/etc/hosts path=/tmp/hosts state=link&quot;</span>

<span class="token comment"># 使用copy模块 src主机文件 dest目标主机目录(加文件名为改名)</span>
<span class="token comment"># 复制文件</span>
ansible 主机集合 <span class="token parameter variable">-m</span> copy <span class="token parameter variable">-a</span> <span class="token string">&quot;src=/主机文件 dest=/目标主机位置/&quot;</span>
<span class="token comment"># 如果目标主机存在先备份</span>
ansible 主机集合 <span class="token parameter variable">-m</span> copy <span class="token parameter variable">-a</span> <span class="token string">&quot;src=/主机文件 dest=/tmp/ backup=yes&quot;</span>
<span class="token comment"># 写入内容并拷贝</span>
ansible 主机集合 <span class="token parameter variable">-m</span> copy <span class="token parameter variable">-a</span> <span class="token string">&quot;content=&#39;hello&#39; desc=/tmp/abc.txt&quot;</span>

<span class="token comment"># 使用fetch模块 将远程文件拷贝到本地</span>
ansible 主机集合 <span class="token parameter variable">-m</span> fetch <span class="token parameter variable">-a</span> <span class="token string">&quot;src=/tmp/abc.txt dest=/tmp/&quot;</span>

<span class="token comment"># 使用lineinfile模块 修改单个文件的单行内容</span>
<span class="token comment"># 在文件中添加一行内容(默认添加到最后)</span>
ansible 主机集合 <span class="token parameter variable">-m</span> lineinfile <span class="token parameter variable">-a</span> <span class="token string">&quot;path=/tmp/text line=&#39;hello&#39;&quot;</span>
<span class="token comment"># 在文件test行后添加内容</span>
ansible 主机集合 <span class="token parameter variable">-m</span> lineinfile <span class="token parameter variable">-a</span> <span class="token string">&quot;path=/tmp/text line=&#39;hello&#39; insertafter=&#39;test&#39;&quot;</span>
<span class="token comment"># 替换文件中的hello为nihao</span>
ansible 主机集合 <span class="token parameter variable">-m</span> lineinfile <span class="token parameter variable">-a</span> <span class="token string">&quot;path=/tmp/text regexp=&#39;hello&#39; replase=&#39;nihao&#39;&quot;</span>

<span class="token comment"># 使用systemd管理模块</span>
<span class="token comment"># 启动服务</span>
ansible hosts <span class="token parameter variable">-m</span> systemd <span class="token parameter variable">-a</span> <span class="token string">&quot;name=nginx state=started&quot;</span>
<span class="token comment"># 关闭服务</span>
ansible hosts <span class="token parameter variable">-m</span> systemd <span class="token parameter variable">-a</span> <span class="token string">&quot;name=nginx state=stopped&quot;</span>
<span class="token comment"># 重新加载配置文件</span>
ansible hosts <span class="token parameter variable">-m</span> systemd <span class="token parameter variable">-a</span> <span class="token string">&quot;name=nginx state=reloaded&quot;</span>
<span class="token comment"># 重启服务</span>
ansible hosts <span class="token parameter variable">-m</span> systemd <span class="token parameter variable">-a</span> <span class="token string">&quot;name=nginx state=restarted&quot;</span>

<span class="token comment"># 使用yum模块</span>
<span class="token comment"># yum安装软件</span>
ansible hosts <span class="token parameter variable">-m</span> yum <span class="token parameter variable">-a</span> <span class="token string">&quot;name=nginx state=installed&quot;</span>
<span class="token comment"># yum卸载软件</span>
ansible hosts <span class="token parameter variable">-m</span> yum <span class="token parameter variable">-a</span> <span class="token string">&quot;name=nginx state=removed&quot;</span>
<span class="token comment"># yum更新软件</span>
ansible hosts <span class="token parameter variable">-m</span> yum <span class="token parameter variable">-a</span> <span class="token string">&quot;name=nginx state=lastest&quot;</span>

<span class="token comment"># 使用git_url模块</span>
ansible hosts <span class="token parameter variable">-m</span> git_url <span class="token parameter variable">-a</span> <span class="token string">&quot;url=&#39;https://mirros.aliyun.com&#39; dest=/tmp/tools/&quot;</span>

<span class="token comment"># 使用mount模块(一般挂载nfs)</span>
<span class="token comment"># 挂载</span>
ansible hosts <span class="token parameter variable">-m</span> <span class="token function">mount</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;fstype=nfs src=192.168.1.1:/wwwdata path=/mnt state=mountd&quot;</span>
<span class="token comment"># 卸载不修改fstab</span>
ansible hosts <span class="token parameter variable">-m</span> <span class="token function">mount</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;fstype=nfs src=192.168.1.1:/wwwdata path=/mnt state=umountd&quot;</span>
<span class="token comment"># 卸载修改fstab</span>
ansible hosts <span class="token parameter variable">-m</span> <span class="token function">mount</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;fstype=nfs src=192.168.1.1:/wwwdata path=/mnt state=absent&quot;</span>

<span class="token comment"># 使用cron模块</span>
<span class="token comment"># 添加定时任务</span>
ansible hosts <span class="token parameter variable">-m</span> <span class="token function">cron</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;name=test state=present minute=&#39;*/2&#39; job=&#39;/bin/ntpdate ntp1.aliyun.com &amp;&gt;/dev/null&#39;&quot;</span>
<span class="token comment"># 删除定时任务</span>
ansible hosts <span class="token parameter variable">-m</span> <span class="token function">cron</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;name=test state=absent&quot;</span>
<span class="token comment"># 注释不删除定时任务 disable=no为取消注释</span>
ansible hosts <span class="token parameter variable">-m</span> <span class="token function">cron</span> <span class="token parameter variable">-a</span> <span class="token string">&quot;name=test minute=&#39;*/2&#39; job=&#39;/bin/ntpdate ntp1.aliyun.com &amp;&gt;/dev/null state=present disable=yes&quot;</span>

<span class="token comment"># 使用group模块 state=absent为删除组</span>
ansible hosts <span class="token parameter variable">-m</span> group <span class="token parameter variable">-a</span> <span class="token string">&quot;name=www gid=2000 state=present&quot;</span>

<span class="token comment"># 使用user模块</span>
ansible hosts <span class="token parameter variable">-m</span> user <span class="token parameter variable">-a</span> <span class="token string">&quot;name=www uid=1999 group=www shell=/bin/bash create_home=yes state=present&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><h4 id="ansible-doc命令" tabindex="-1"><a class="header-anchor" href="#ansible-doc命令" aria-hidden="true">#</a> Ansible-doc命令</h4></li></ul><p><code>ansible-doc</code> 是查看 <code>Ansible</code> 模块说明命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 列出所有模块</span>
ansible-doc <span class="token parameter variable">-l</span>

<span class="token comment"># 查看模块帮助 -为可选项 =为强制选项</span>
ansible-doc yum
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ansible-playbook剧本详解" tabindex="-1"><a class="header-anchor" href="#ansible-playbook剧本详解" aria-hidden="true">#</a> Ansible Playbook剧本详解</h3><ul><li><h4 id="语法格式yaml" tabindex="-1"><a class="header-anchor" href="#语法格式yaml" aria-hidden="true">#</a> 语法格式<a href="/html/docs/linux/system/doubt.html#yaml%E6%A0%BC%E5%BC%8F" class="">YAML</a></h4><ul><li>hosts(主机)</li><li>tasks(任务)</li><li>variables(变量)</li><li>roles(角色)</li></ul></li><li><h4 id="变量" tabindex="-1"><a class="header-anchor" href="#变量" aria-hidden="true">#</a> 变量</h4></li></ul><h5 id="剧本变量" tabindex="-1"><a class="header-anchor" href="#剧本变量" aria-hidden="true">#</a> 剧本变量</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>---
<span class="token comment"># 主机集合</span>
- hosts: db
  vars:
    file: /etc/hostname
  tasks:
    - name: <span class="token builtin class-name">test</span>
      <span class="token comment"># 如果变量开头要加引号</span>
      shell: <span class="token builtin class-name">echo</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">file</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="文件变量" tabindex="-1"><a class="header-anchor" href="#文件变量" aria-hidden="true">#</a> 文件变量</h5><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># /tmp/vars_file.yml</span>
file: /etc/hostname
node: /etc/hosts

<span class="token comment"># 剧本调用</span>
---
- hosts: all
  vars_files: /tmp/vars_file.yml
  tasks:
    - name: <span class="token builtin class-name">test</span>
      shell: <span class="token builtin class-name">echo</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">node</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="分组变量" tabindex="-1"><a class="header-anchor" href="#分组变量" aria-hidden="true">#</a> 分组变量</h5><p>在Ansible目录下创建目录 自动识别各分组变量</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 创建目录格式 目录名为主机集合分组</span>
group_vars/
├── db
│   └── vars.yml
├── nfs
│   └── vars.yml
├── systemd
│   └── vars.yml
└── web
    └── vars.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="facts变量-内置变量" tabindex="-1"><a class="header-anchor" href="#facts变量-内置变量" aria-hidden="true">#</a> facts变量 内置变量</h5><p>Ansible运行剧本时系统收集服务器信息变量</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看ansible facts变量内容</span>
ansible <span class="token parameter variable">-i</span> hosts all <span class="token parameter variable">-m</span> setup

<span class="token comment"># 常用fact变量</span>
<span class="token comment"># 主机名</span>
ansible_hostname
<span class="token comment"># 内存大小 MB</span>
ansible_memtotal_mb
<span class="token comment"># cpu数量</span>
ansible_processor_vcpus
<span class="token comment"># 默认网卡ip</span>
ansible_default_ipv4.assress
<span class="token comment"># linux发行版本</span>
ansible_distribution
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><h4 id="语法实例" tabindex="-1"><a class="header-anchor" href="#语法实例" aria-hidden="true">#</a> 语法实例</h4></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>---
<span class="token comment"># 主机集合</span>
- hosts: all,test1
  <span class="token comment"># 任务(可以为多个)</span>
  tasks:
    <span class="token comment"># 任务名</span>
    - name: tasks name
    <span class="token comment"># 调用模块</span>
    ping: 
    <span class="token comment"># 任务名</span>
    -name: task name
    <span class="token comment"># 调用模块及命令</span>
    shell: <span class="token function">touch</span> /tmp/abc.txt
- hosts: test2
  tasks: 
    -name: tasks name
    shell: <span class="token function">touch</span> /tmp/intex.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><h4 id="剧本命令" tabindex="-1"><a class="header-anchor" href="#剧本命令" aria-hidden="true">#</a> 剧本命令</h4></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 运行剧本</span>
ansible-playbook test.yml
<span class="token comment"># 指定主机集合</span>
ansible-playbook <span class="token parameter variable">-i</span> hosts test.yml
<span class="token comment"># 检查语法</span>
ansible-playbook test.yml <span class="token parameter variable">-C</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-9833b164.js" defer></script>
  </body>
</html>
